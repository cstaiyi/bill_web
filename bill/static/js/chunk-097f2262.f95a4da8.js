(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-097f2262"],{"20f6":function(t,e,a){},"9c16":function(t,e,a){"use strict";var i=a("20f6"),s=a.n(i);s.a},b3b7:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"view-archives-archivesIndex"},[a("Button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary"},on:{click:t.addClick}},[t._v("新增流水")]),t._v("\n            查询：\n        "),a("Select",{staticStyle:{width:"150px","margin-top":"-8px"},attrs:{placeholder:"请选择一级消费",filterable:""},on:{"on-change":t.changeFirstSearch},model:{value:t.pageParams.firstConsumptionId,callback:function(e){t.$set(t.pageParams,"firstConsumptionId",e)},expression:"pageParams.firstConsumptionId"}},t._l(t.firstListName,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1),a("Select",{staticStyle:{"margin-left":"10px",width:"150px","margin-top":"-8px"},attrs:{placeholder:"请选择二级消费",filterable:""},model:{value:t.pageParams.secondConsumptionName,callback:function(e){t.$set(t.pageParams,"secondConsumptionName",e)},expression:"pageParams.secondConsumptionName"}},t._l(t.secondListName,function(e){return a("Option",{key:e.name,attrs:{value:e.name}},[t._v(t._s(e.name))])}),1),a("Button",{staticStyle:{"margin-left":"10px","margin-top":"-8px"},attrs:{type:"primary"},on:{click:t.queryData}},[t._v("查询")]),a("Table",{attrs:{loading:t.loading,border:"",columns:t.tbColumns,data:t.tbData}}),a("Row",[a("Col",{attrs:{span:"24"}},[a("div",{staticClass:"page"},[a("Page",{attrs:{total:t.total,current:t.pageParams.current,"page-size":t.pageParams.size,"show-total":""},on:{"on-change":t.onChange}})],1)])],1)],1),a("Modal",{attrs:{title:"流水信息"},on:{"on-ok":function(e){return t.ok("refVallidate")},"on-cancel":function(e){return t.cancel("refVallidate")}},model:{value:t.modal1,callback:function(e){t.modal1=e},expression:"modal1"}},[a("div",{staticClass:"form"},[a("i-form",{ref:"refVallidate",attrs:{model:t.formValidate,"label-width":100}},[a("Form-item",{attrs:{label:"发生时间：",prop:""}},[a("Col",{attrs:{span:"12",offset:"1"}},[a("DatePicker",{staticStyle:{"margin-left":"-15px",width:"200px"},attrs:{format:"yyyy-MM-dd HH:mm:ss",clearable:!1,type:"datetime",placeholder:"请选择"},on:{"on-change":t.dateChange},model:{value:t.formValidate.billDate,callback:function(e){t.$set(t.formValidate,"billDate",e)},expression:"formValidate.billDate"}})],1)],1),a("Form-item",{attrs:{label:"消费类型：",prop:""}},[a("Select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择",filterable:""},on:{"on-change":t.changeFirst},model:{value:t.formValidate.firstConsumptionId,callback:function(e){t.$set(t.formValidate,"firstConsumptionId",e)},expression:"formValidate.firstConsumptionId"}},t._l(t.firstConsumptionList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1),a("Select",{staticStyle:{"margin-left":"10px",width:"150px"},attrs:{placeholder:"请选择",filterable:""},model:{value:t.formValidate.secondConsumptionName,callback:function(e){t.$set(t.formValidate,"secondConsumptionName",e)},expression:"formValidate.secondConsumptionName"}},t._l(t.secondConsumptionList,function(e){return a("Option",{key:e.name,attrs:{value:e.name}},[t._v(t._s(e.name))])}),1)],1),a("Form-item",{attrs:{label:"金额(元)：",prop:""}},[a("InputNumber",{staticStyle:{width:"70px"},attrs:{type:"number",max:1e5,min:0},model:{value:t.formValidate.money,callback:function(e){t.$set(t.formValidate,"money",e)},expression:"formValidate.money"}})],1),a("Form-item",{attrs:{label:"支付方式：",prop:""}},[a("Select",{staticStyle:{width:"90px"},attrs:{placeholder:"请选择",filterable:""},model:{value:t.formValidate.style,callback:function(e){t.$set(t.formValidate,"style",e)},expression:"formValidate.style"}},[a("Option",{attrs:{value:"微信支付"}},[t._v("微信支付")]),a("Option",{attrs:{value:"混合支付"}},[t._v("混合支付")]),a("Option",{attrs:{value:"支付宝"}},[t._v("支付宝")]),a("Option",{attrs:{value:"银行卡"}},[t._v("银行卡")]),a("Option",{attrs:{value:"现金"}},[t._v("现金")]),a("Option",{attrs:{value:"其他"}},[t._v("其他")])],1)],1),a("Form-item",{attrs:{label:"支付成员：",prop:""}},[a("Select",{staticStyle:{width:"90px"},attrs:{placeholder:"请选择",filterable:""},model:{value:t.selectMemberId,callback:function(e){t.selectMemberId=e},expression:"selectMemberId"}},t._l(t.memberList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1),a("Select",{staticStyle:{"margin-left":"10px",width:"90px"},attrs:{placeholder:"请选择",filterable:""},model:{value:t.sortId,callback:function(e){t.sortId=e},expression:"sortId"}},t._l(t.sortList,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1),a("InputNumber",{staticStyle:{"margin-left":"10px",width:"70px"},attrs:{type:"number",max:1e5,min:0},model:{value:t.payNumber,callback:function(e){t.payNumber=e},expression:"payNumber"}}),a("i-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"ios-plus-empty",type:"dashed"},on:{click:t.addMemberClick}},[t._v("添加  ")])],1),null!=t.payMemberList?a("Form-item",{staticStyle:{"margin-left":"-80px"},attrs:{label:"",prop:""}},t._l(t.payMemberList,function(e){return a("Tag",{attrs:{type:"dot",closable:"",color:"blue"},on:{"on-close":function(a){return t.payMemberClose(e.name)}}},[t._v(t._s(e.showName))])}),1):t._e(),null==t.payMemberList[0]?a("Form-item",{attrs:{label:"请注意：",prop:""}},[a("span",[t._v("至少要添加一位支付成员")])]):t._e(),a("Form-item",{attrs:{label:"备注："}},[a("i-input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:3,maxRows:5}},model:{value:t.formValidate.mark,callback:function(e){t.$set(t.formValidate,"mark",e)},expression:"formValidate.mark"}})],1)],1)],1)])],1)},s=[];a("7f7f"),a("3b2b"),a("a481");Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t};var r={name:"archivesIndex",components:{},data:function(){var t=this;this.$createElement;return{pageParams:{current:1,size:10,registerId:"",firstConsumptionId:"",secondConsumptionName:""},userInfo:{},total:0,detailId:"",editFlag:1,addShow:!1,detailShow:!1,loading:!1,modal1:!1,firstConsumptionList:[],secondConsumptionList:[],memberList:[],selectMemberId:"",payMemberList:[],firstListName:[],secondListName:[],formValidate:{id:"",registerId:"",billDate:"",firstConsumptionId:"",secondConsumptionName:"",money:0,payMemberList:[],mark:"",style:""},payNumber:0,sortId:1,sortList:[{id:"1",name:"比例支付"},{id:"2",name:"具体金额"}],tbColumns:[{title:"发生时间",key:"billDate",width:150},{title:"一级消费类型",key:"firstConsumptionName",width:120},{title:"二级消费类型",key:"secondConsumptionName",width:120},{title:"支付方式",key:"style",minWidth:100},{title:"金额(元)",key:"money",width:100},{title:"支付成员",key:"payName",minWidth:200},{title:"创建时间",key:"createTime",width:150},{title:"备注",key:"mark",minWidth:200},{title:"操作",key:"action",width:200,fixed:"right",align:"center",render:function(e,a){return e("div",[e("i-button",{attrs:{type:"warning",size:"small"},on:{click:function(){t.updateClick(a.row)}}},["修改"]),"  ",e("i-button",{attrs:{type:"error",size:"small"},on:{click:function(){t.deleteClick(a.row)}}},["删除"])])}}],tbData:[]}},mounted:function(){var t=window.localStorage.getItem("userInfo");this.userInfo=JSON.parse(t),console.log("===================="),this.firstList()},methods:{dateChange:function(t){this.formValidate.billDate=t},changeFirst:function(t){var e=this;this.modal1&&this.$axios.request({url:this.$api.consumption.findSecondDetail,params:{id:t},method:"get"}).then(function(t){200===t.data.code?(e.secondConsumptionList=t.data.data,e.secondListName=t.data.data):e.$Message.warning(t.data.message),e.loading=!1})},changeFirstSearch:function(t){var e=this;this.$axios.request({url:this.$api.consumption.findSecondDetail,params:{id:t},method:"get"}).then(function(t){200===t.data.code?(e.secondConsumptionList=t.data.data,e.secondListName=t.data.data):e.$Message.warning(t.data.message),e.loading=!1})},addMemberClick:function(){if(1!=this.sortId||this.payNumber==Math.floor(this.payNumber)){for(var t=0;t<this.memberList.length;t++)if(this.memberList[t].id==this.selectMemberId){this.payMemberList.push({id:this.selectMemberId,name:this.memberList[t].name,payNumber:this.payNumber,sortId:this.sortId,showName:"1"==this.sortId?this.memberList[t].name+"-"+this.payNumber+"%":this.memberList[t].name+"-"+this.payNumber+"元"}),this.memberList.splice(t,1),null!=this.memberList[0]?this.selectMemberId=this.memberList[0].id:this.selectMemberId="";break}}else this.$Message.warning("比例支付的数值目前只整数")},payMemberClose:function(t){for(var e=0;e<this.payMemberList.length;e++)if(this.payMemberList[e].name==t){this.memberList.push(this.payMemberList[e]),null==this.memberList[1]&&(this.selectMemberId=this.memberList[0].id),this.payMemberList.splice(e,1);break}},queryData:function(){var t=this;this.pageParams.registerId=this.userInfo.id,this.$axios.request({url:this.$api.bill.pageBill,params:this.pageParams,method:"get"}).then(function(e){200===e.data.code?(t.total=e.data.total,t.tbData=e.data.data):t.$Message.warning(e.data.message),t.loading=!1})},firstList:function(){var t=this;this.$axios.request({url:this.$api.consumption.findFirstList,params:{id:this.userInfo.id},method:"get"}).then(function(e){200===e.data.code?(t.firstListName=e.data.data,t.queryData()):t.$Message.warning(e.data.message),t.loading=!1})},addClick:function(){var t=this;this.payNumber=0,this.sortId="1",this.selectMemberId="",this.payMemberList=[],this.secondConsumptionList=[],this.editFlag=1,this.modal1=!0,this.$axios.request({url:this.$api.consumption.findFirstList,params:{id:this.userInfo.id},method:"get"}).then(function(e){200===e.data.code?(t.firstConsumptionList=e.data.data,t.$axios.request({url:t.$api.member.findMemberList,params:{id:t.userInfo.id},method:"get"}).then(function(e){200===e.data.code?t.memberList=e.data.data:t.$Message.warning(e.data.message),t.loading=!1})):t.$Message.warning(e.data.message),t.loading=!1})},updateClick:function(t){var e=this;this.payNumber=0,this.sortId="1",this.selectMemberId="",this.payMemberList=[],this.editFlag=2,this.modal1=!0,this.$axios.request({url:this.$api.consumption.findFirstList,params:{id:this.userInfo.id},method:"get"}).then(function(a){200===a.data.code?(e.firstConsumptionList=a.data.data,e.$axios.request({url:e.$api.member.findMemberList,params:{id:e.userInfo.id},method:"get"}).then(function(a){200===a.data.code?(e.memberList=a.data.data,e.$axios.request({url:e.$api.bill.findBillById,params:{id:t.id},method:"get"}).then(function(t){if(200===t.data.code){e.formValidate=t.data.data,e.changeFirst(e.formValidate.firstConsumptionId);for(var a=0;a<e.formValidate.payMemberList.length;a++){e.payMemberList.push({id:e.formValidate.payMemberList[a].memberId,name:e.formValidate.payMemberList[a].name,payNumber:e.formValidate.payMemberList[a].typeNumber,sortId:e.formValidate.payMemberList[a].type,showName:"1"==e.formValidate.payMemberList[a].type?e.formValidate.payMemberList[a].name+"-"+e.formValidate.payMemberList[a].typeNumber+"%":e.formValidate.payMemberList[a].name+"-"+e.formValidate.payMemberList[a].typeNumber+"元"});for(var i=0;i<e.memberList.length;i++)if(e.memberList[i].id==e.formValidate.payMemberList[a].memberId){e.memberList.splice(i,1);break}}}else e.$Message.warning(t.data.message);e.loading=!1})):e.$Message.warning(a.data.message),e.loading=!1})):e.$Message.warning(a.data.message),e.loading=!1})},onChange:function(t){this.pageParams.current=t,this.queryData()},deleteClick:function(t){var e=this;this.$Modal.confirm({title:"删除",content:"<h4>确认删除该条数据吗？</h4>",onOk:function(){e.$axios.request({url:e.$api.bill.deleteById,params:{id:t.id},method:"get"}).then(function(t){200===t.data.code?(e.queryData(),e.$Message.success(t.data.message)):e.$Message.warning(t.data.message)})}})},ok:function(){for(var t=this,e=[],a=0;a<this.payMemberList.length;a++){var i={memberId:this.payMemberList[a].id,type:this.payMemberList[a].sortId,typeNumber:this.payMemberList[a].payNumber};e.push(i)}this.formValidate.registerId=this.userInfo.id,this.formValidate.payMemberList=e,"string"!==typeof this.formValidate.billDate&&(this.formValidate.billDate=this.formValidate.billDate.format("yyyy-MM-dd hh:mm:ss")),null!=this.formValidate.billDate&&""!=this.formValidate.billDate?null!=this.formValidate.firstConsumptionId&&""!=this.formValidate.firstConsumptionId?null!=this.formValidate.secondConsumptionName&&""!=this.formValidate.secondConsumptionName?0!=this.formValidate.money?null!=this.formValidate.payMemberList&&null!=this.formValidate.payMemberList[0]?this.$axios.request({url:this.$api.bill.addOrUpdate,data:this.formValidate,method:"post"}).then(function(e){200===e.data.code?(t.modal1=!1,t.queryData(),t.$Message.success(e.data.message),t.formValidate={}):t.$Message.warning(e.data.message)}):this.$Message.warning("至少要添加一位支付成员"):this.$Message.warning("金额不能为0"):this.$Message.warning("二级消费类型不能为空"):this.$Message.warning("一级消费类型不能为空"):this.$Message.warning("发生时间不能为空")},cancel:function(){this.modal1=!1,this.formValidate={}}}},n=r,o=(a("9c16"),a("2877")),l=Object(o["a"])(n,i,s,!1,null,null,null);e["default"]=l.exports}}]);